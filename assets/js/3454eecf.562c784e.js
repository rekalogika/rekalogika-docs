"use strict";(self.webpackChunkrekalogika_docs=self.webpackChunkrekalogika_docs||[]).push([[2500],{7370:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"analytics/value-resolver/property-path","title":"Property Path","description":"Basically all ValueResolvers accept property path. This allows you to specify","source":"@site/docs/analytics/05-value-resolver/05-property-path.md","sourceDirName":"analytics/05-value-resolver","slug":"/analytics/value-resolver/property-path","permalink":"/analytics/value-resolver/property-path","draft":false,"unlisted":false,"editUrl":"https://github.com/rekalogika/rekalogika-docs/edit/main/docs/analytics/05-value-resolver/05-property-path.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Property Path"},"sidebar":"docs","previous":{"title":"Custom DQL Value Resolver","permalink":"/analytics/value-resolver/custom-dql-value-resolver"},"next":{"title":"Internals","permalink":"/analytics/internals/"}}');var a=t(4848),r=t(8453);const o={title:"Property Path"},i=void 0,l={},c=[{value:"Example of Using a Property Path in a Dimension",id:"example-of-using-a-property-path-in-a-dimension",level:2},{value:"Resolve to a Property",id:"resolve-to-a-property",level:2},{value:"Getting the Alias of a Related Entity",id:"getting-the-alias-of-a-related-entity",level:2},{value:"Casting to a Class",id:"casting-to-a-class",level:2}];function u(e){const n={admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["Basically all ",(0,a.jsx)(n.code,{children:"ValueResolver"}),"s accept property path. This allows you to specify\na path to a specific property from the root entity, traversing through related\nentities. The framework will automatically make the necessary joins behind the\nscenes."]}),"\n",(0,a.jsx)(n.h2,{id:"example-of-using-a-property-path-in-a-dimension",children:"Example of Using a Property Path in a Dimension"}),"\n",(0,a.jsx)(n.p,{children:"This is how you can use a property path in a dimension:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use Doctrine\\DBAL\\Types\\Types;\nuse Doctrine\\ORM\\Mapping as ORM;\nuse Rekalogika\\Analytics\\Attribute as Analytics;\nuse Rekalogika\\Analytics\\ValueResolver\\PropertyValueResolver;\n\n#[ORM\\Entity()]\n#[Analytics\\Summary(\n    sourceClass: Order::class,\n)]\nclass OrderSummary extends Summary\n{\n    #[ORM\\Column(type: Types::STRING)]\n    #[Analytics\\Dimension(\n        // highlight-start\n        source: new PropertyValueResolver('customer.country.name'),\n        // highlight-end\n    )]\n    private ?string $countryName = null;\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["In this example, from the root ",(0,a.jsx)(n.code,{children:"Order"})," object, we traverse the ",(0,a.jsx)(n.code,{children:"customer"}),"\nrelation, and then the ",(0,a.jsx)(n.code,{children:"country"})," relation to get the ",(0,a.jsx)(n.code,{children:"name"})," property."]}),"\n",(0,a.jsxs)(n.p,{children:["In the following sections, we will only include how to use property paths in\n",(0,a.jsx)(n.code,{children:"ValueResolver"})," objects, omitting the rest of the code for brevity."]}),"\n",(0,a.jsx)(n.h2,{id:"resolve-to-a-property",children:"Resolve to a Property"}),"\n",(0,a.jsx)(n.p,{children:"The most common usage is to resolve to a property:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use Rekalogika\\Analytics\\ValueResolver\\PropertyValueResolver;\n\n$valueResolver = new PropertyValueResolver('customer.country.name');\n"})}),"\n",(0,a.jsx)(n.h2,{id:"getting-the-alias-of-a-related-entity",children:"Getting the Alias of a Related Entity"}),"\n",(0,a.jsxs)(n.p,{children:["Some DQL functions expect the alias of a related entity to be passed as an\nargument, including the ",(0,a.jsx)(n.code,{children:"INSTANCE OF"})," clause. You can use the ",(0,a.jsx)(n.code,{children:"*"})," symbol to get\nthe alias of a related entity:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use Rekalogika\\Analytics\\ValueResolver\\CustomDQLValueResolver;\n\n$valueResolver = new CustomDQLValueResolver(\"\n    CASE\n        // highlight-start\n        WHEN [customer.*] INSTANCE OF App\\Entity\\IndividualCustomer\n        // highlight-end\n        THEN [customer(App\\Entity\\IndividualCustomer).gender]\n\n        ELSE NULLIF('a','a')\n    END\n\");\n"})}),"\n",(0,a.jsx)(n.h2,{id:"casting-to-a-class",children:"Casting to a Class"}),"\n",(0,a.jsxs)(n.p,{children:["It is possible to cast a related entity to a specific class using parentheses.\nThis is useful if you need to access a property that is not defined in the root\nentity. This is an advanced feature, and probably only makes sense if you are\nusing ",(0,a.jsx)(n.code,{children:"CustomDQLValueResolver"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use Rekalogika\\Analytics\\ValueResolver\\CustomDQLValueResolver;\n\n$valueResolver = new CustomDQLValueResolver(\"\n    CASE\n        WHEN [customer.*] INSTANCE OF App\\Entity\\IndividualCustomer\n        // highlight-start\n        THEN [customer(App\\Entity\\IndividualCustomer).gender]\n        // highlight-end\n\n        ELSE NULLIF('a','a')\n    END\n\");\n"})}),"\n",(0,a.jsxs)(n.admonition,{type:"info",children:[(0,a.jsxs)(n.p,{children:["To implement the class casting, the framework will create an additional join\nusing the ",(0,a.jsx)(n.code,{children:"WITH"})," clause:"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use Doctrine\\ORM\\QueryBuilder;\n\n/** @var QueryBuilder $queryBuilder */\n\n$queryBuilder\n    ->from(Order::class, '_a0')\n    ->leftJoin('_a0.customer', '_a1') // Customer::class\n    // highlight-start\n    ->leftJoin(\n        IndividualCustomer::class,\n        '_a2',\n        'WITH',\n        '_a2.id = _a1.id',\n    );\n    // highlight-end\n"})})]})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>i});var s=t(6540);const a={},r=s.createContext(a);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);