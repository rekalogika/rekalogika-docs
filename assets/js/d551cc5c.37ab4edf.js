"use strict";(self.webpackChunkrekalogika_docs=self.webpackChunkrekalogika_docs||[]).push([[158],{2659:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var i=t(5893),o=t(1151);const s={title:"Design Considerations & Decisions"},r=void 0,a={id:"api-lite/design",title:"Design Considerations & Decisions",description:"Some of our design considerations and decisions based on our experience. These",source:"@site/docs/api-lite/02-design.md",sourceDirName:"api-lite",slug:"/api-lite/design",permalink:"/api-lite/design",draft:!1,unlisted:!1,editUrl:"https://github.com/rekalogika/rekalogika-docs/edit/main/docs/api-lite/02-design.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Design Considerations & Decisions"},sidebar:"docs",previous:{title:"Components Overview",permalink:"/api-lite/components"},next:{title:"AbstractState",permalink:"/api-lite/abstractstate"}},d={},c=[{value:"Component Decoupling",id:"component-decoupling",level:2},{value:"DTOs as the <code>ApiResource</code>",id:"dtos-as-the-apiresource",level:2},{value:"No Serialization Groups",id:"no-serialization-groups",level:2},{value:"Separate Input and Output DTOs",id:"separate-input-and-output-dtos",level:2},{value:"Provider-less Operations",id:"provider-less-operations",level:2},{value:"Authorization",id:"authorization",level:2}];function l(e){const n={admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Some of our design considerations and decisions based on our experience. These\nare what we consider as the best practice of using API Platform. Some of these\nare more opinionated than the others, and might or might not apply to your\nproject."}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"We are an exclusive REST/OpenAPI shop. Our approach might have issues with\nGraphQL, but we cannot say for sure. If you know something, please let us know."})}),"\n",(0,i.jsx)(n.h2,{id:"component-decoupling",children:"Component Decoupling"}),"\n",(0,i.jsxs)(n.p,{children:["API Platform must not implicitly interact with Doctrine or other persistence\nlayer behind the scenes. You can do that by not attaching ",(0,i.jsx)(n.code,{children:"#[ApiResource]"})," to\nany Doctrine entities. But to make sure this is the case, you can add these\noptions to your configuration:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="config/packages/api_platform.yaml"',children:"api_platform:\n    doctrine:\n        enabled: false\n    doctrine_mongodb_odm:\n        enabled: false\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"dtos-as-the-apiresource",children:["DTOs as the ",(0,i.jsx)(n.code,{children:"ApiResource"})]}),"\n",(0,i.jsxs)(n.p,{children:["Domain entities are not designated ",(0,i.jsx)(n.code,{children:"ApiResource"}),". Instead, we create a DTO for\nthe purpose. Then, in the state providers and processors, we will map the entity\nto the DTO, and return the DTO."]}),"\n",(0,i.jsx)(n.h2,{id:"no-serialization-groups",children:"No Serialization Groups"}),"\n",(0,i.jsxs)(n.p,{children:["Serialization groups are not scalable. They can start becoming unwieldy as the\nproject grows. Instead, if we need a different API representation of the same\nentity, we explicitly create multiple DTOs that act as the ",(0,i.jsx)(n.code,{children:"ApiResource"}),". These\ndifferent DTOs should get a different URL and a different ",(0,i.jsx)(n.code,{children:"shortName"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"separate-input-and-output-dtos",children:"Separate Input and Output DTOs"}),"\n",(0,i.jsx)(n.p,{children:"Avoid using the same DTO as both input and output, and using serialization\ngroups to define the differences between the two. Instead, we use a separate DTO\nfor input and output."}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"ApiResource"})," DTOs defines the output data structure. In POST, PUT, and\nPATCH endpoints, we create another DTO to represent the input data structure. In\nthe ",(0,i.jsx)(n.code,{children:"ApiResource"})," DTO, we use the ",(0,i.jsx)(n.code,{children:"input"})," argument to point to the input DTO."]}),"\n",(0,i.jsx)(n.h2,{id:"provider-less-operations",children:"Provider-less Operations"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ApiResource"})," and all of its operations do not get assigned a provider, except\nfor ",(0,i.jsx)(n.code,{children:"Get"})," and ",(0,i.jsx)(n.code,{children:"GetCollection"}),". All processors get their data directly from the\nrepository. We find this degree of explicitness helps with DX, readability, and\nflexibility."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Get"})," and ",(0,i.jsx)(n.code,{children:"GetCollection"})," also gets a separate provider each for more\nexplicitness."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Put"}),", ",(0,i.jsx)(n.code,{children:"Patch"}),", and ",(0,i.jsx)(n.code,{children:"Delete"})," will require a ",(0,i.jsx)(n.code,{children:"read: false"})," option to prevent\n",(0,i.jsx)(n.code,{children:"404"})," error."]}),"\n",(0,i.jsx)(n.h2,{id:"authorization",children:"Authorization"}),"\n",(0,i.jsxs)(n.p,{children:["Because of the nature of our provider-less operations above, the ",(0,i.jsx)(n.code,{children:"security"}),"\nproperty in ",(0,i.jsx)(n.code,{children:"ApiResource"})," and its operations will be less useful, as ",(0,i.jsx)(n.code,{children:"object"}),"\nwill either be ",(0,i.jsx)(n.code,{children:"null"})," or points to the DTO, not the entity."]}),"\n",(0,i.jsxs)(n.p,{children:["Instead, our ",(0,i.jsx)(n.code,{children:"AbstractState"})," provides ",(0,i.jsx)(n.code,{children:"isGranted()"})," and\n",(0,i.jsx)(n.code,{children:"denyAccessUnlessGranted()"})," methods that most of us are already familiar.\nSecurity checks involving an action toward an object should be done next to the\naction anyway, not in a separate class. Otherwise, it can easily lead to coding\nerrors and reduces readability."]})]})}function p(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>a,a:()=>r});var i=t(7294);const o={},s=i.createContext(o);function r(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);