"use strict";(self.webpackChunkrekalogika_docs=self.webpackChunkrekalogika_docs||[]).push([[2357],{7713:(e,l,i)=>{i.r(l),i.d(l,{assets:()=>r,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"file/null-file","title":"Null File","description":"This chapter describes the null object pattern applied to files.","source":"@site/docs/file/08-null-file.md","sourceDirName":"file","slug":"/file/null-file","permalink":"/file/null-file","draft":false,"unlisted":false,"editUrl":"https://github.com/rekalogika/rekalogika-docs/edit/main/docs/file/08-null-file.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"title":"Null File"},"sidebar":"docs","previous":{"title":"Lazy-Loading Proxy","permalink":"/file/proxy"},"next":{"title":"rekalogika/file-bundle","permalink":"/file-bundle/"}}');var t=i(4848),a=i(8453);const o={title:"Null File"},s=void 0,r={},c=[{value:"The Missing File Problem",id:"the-missing-file-problem",level:2},{value:"Solution: Use a <code>NullFile</code> Object",id:"solution-use-a-nullfile-object",level:2},{value:"Usage",id:"usage",level:2},{value:"Checking for a Null File",id:"checking-for-a-null-file",level:2},{value:"<code>InvalidFile</code>: a Null File That is Also an Exception",id:"invalidfile-a-null-file-that-is-also-an-exception",level:2}];function d(e){const l={a:"a",admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.p,{children:"This chapter describes the null object pattern applied to files."}),"\n",(0,t.jsx)(l.h2,{id:"the-missing-file-problem",children:"The Missing File Problem"}),"\n",(0,t.jsx)(l.p,{children:"One of the most common problems when working with files is how to handle the\ncase when the business logic necessitates that a file must be present, but in\nactuality, it is not. For example, if an image has been assigned to a product in\nthe past, the product has a record of it and knows that it has an image. But in\nthe storage, the image is missing for some reason."}),"\n",(0,t.jsx)(l.p,{children:"We can use a standard null value, but by doing so, we will have to check for\nnull every time we want to use the file, as well as do the branching logic\neverywhere. This is tedious and error-prone. Such cases also rarely happen, and\ntherefore the handling logic will also be rarely tested. When it happens, it\noften results in a fatal error, which is not a good user experience."}),"\n",(0,t.jsxs)(l.h2,{id:"solution-use-a-nullfile-object",children:["Solution: Use a ",(0,t.jsx)(l.code,{children:"NullFile"})," Object"]}),"\n",(0,t.jsxs)(l.p,{children:[(0,t.jsx)(l.code,{children:"NullFile"})," is a ",(0,t.jsx)(l.a,{href:"https://martinfowler.com/eaaCatalog/specialCase.html",children:"null object\npattern"})," implementation\nfor files. It is a ",(0,t.jsx)(l.code,{children:"FileInterface"})," that represents the missing file. It appears\nlike a real file to the caller and can be considered a real file by most parts\nof the code."]}),"\n",(0,t.jsx)(l.p,{children:"Instead of a fatal error, your user will now be able to see if there is a file,\nbut something is wrong with it, and will be able to tell the admin about it. The\nadmin will be able to act on it, for example, by re-uploading the file or\nrestoring it from backup."}),"\n",(0,t.jsxs)(l.p,{children:["The ",(0,t.jsx)(l.code,{children:"NullFile"})," does that without much effort from the developer."]}),"\n",(0,t.jsxs)(l.p,{children:["A ",(0,t.jsx)(l.code,{children:"NullFile"})," will only stop acting like a real file if the caller is trying to\noperate on it that would cause a side effect. For example, you will not be able\nto copy a ",(0,t.jsx)(l.code,{children:"NullFile"})," to another location, to change its content, etc. If that\nhappens, ",(0,t.jsx)(l.code,{children:"NullFile"})," will throw a ",(0,t.jsx)(l.code,{children:"NullFileOperationException"}),"."]}),"\n",(0,t.jsx)(l.h2,{id:"usage",children:"Usage"}),"\n",(0,t.jsxs)(l.admonition,{title:"Preparation",type:"info",children:[(0,t.jsxs)(l.p,{children:["You need to install the package ",(0,t.jsx)(l.code,{children:"rekalogika/file-null"})," to use this\nfeature:"]}),(0,t.jsx)(l.pre,{children:(0,t.jsx)(l.code,{className:"language-bash",children:"composer require rekalogika/file-null\n"})})]}),"\n",(0,t.jsxs)(l.p,{children:["An example on how to use ",(0,t.jsx)(l.code,{children:"NullFile"})," in your entity:"]}),"\n",(0,t.jsx)(l.pre,{children:(0,t.jsx)(l.code,{className:"language-php",children:"use Rekalogika\\Contracts\\File\\FileInterface;\nuse Rekalogika\\Domain\\File\\Null\\NullFile;\n\nclass Product {\n    private ?FileInterface $image = null;\n\n    public function __construct(FileInterface $image) {\n        $this->image = $image;\n    }\n\n    // The image must never be null. So, if the image does not exist, we\n    // substitute it with a NullFile instead.\n    public function getImage(): FileInterface {\n        return $this->image ?? new NullFile();\n    }\n}\n"})}),"\n",(0,t.jsx)(l.h2,{id:"checking-for-a-null-file",children:"Checking for a Null File"}),"\n",(0,t.jsxs)(l.p,{children:["All null files implement the ",(0,t.jsx)(l.code,{children:"NullFileInterface"}),". You can use this interface to\ncheck if a file is null:"]}),"\n",(0,t.jsx)(l.pre,{children:(0,t.jsx)(l.code,{className:"language-php",children:"use Rekalogika\\Contracts\\File\\NullFileInterface;\n\n/** @var FileInterface $file */\n\nif ($file instanceof NullFileInterface) {\n    // The file is null.\n}\n"})}),"\n",(0,t.jsxs)(l.h2,{id:"invalidfile-a-null-file-that-is-also-an-exception",children:[(0,t.jsx)(l.code,{children:"InvalidFile"}),": a Null File That is Also an Exception"]}),"\n",(0,t.jsxs)(l.p,{children:["There is also a null file called ",(0,t.jsx)(l.code,{children:"InvalidFile"})," which is identical to the\nstandard ",(0,t.jsx)(l.code,{children:"NullFile"}),", but also extends ",(0,t.jsx)(l.code,{children:"Exception"}),". The idea is that it contains\nthe stack trace where it was instantiated that can help you debug the problem,\nif you can log it somewhere. You can also throw it somewhere down the line if\nyou need it."]}),"\n",(0,t.jsxs)(l.p,{children:["To log an ",(0,t.jsx)(l.code,{children:"InvalidFile"})," you can do something like the following."]}),"\n",(0,t.jsx)(l.pre,{children:(0,t.jsx)(l.code,{className:"language-php",children:"use Rekalogika\\Contracts\\File\\FileInterface;\nuse Psr\\Log\\LoggerInterface;\n\n/** @var FileInterface $file */\n/** @var LoggerInterface $logger */\n\nif ($file instanceof InvalidFile) {\n    $logger->error('Invalid file', [\n        'exception' => $file,\n    ]);\n}\n"})})]})}function h(e={}){const{wrapper:l}={...(0,a.R)(),...e.components};return l?(0,t.jsx)(l,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,l,i)=>{i.d(l,{R:()=>o,x:()=>s});var n=i(6540);const t={},a=n.createContext(t);function o(e){const l=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(l):{...l,...e}},[l,e])}function s(e){let l;return l=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),n.createElement(a.Provider,{value:l},e.children)}}}]);